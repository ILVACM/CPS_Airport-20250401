(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7268b0dc"],{"1d35":function(t,e,o){"use strict";o("62ed")},"62ed":function(t,e,o){},b225:function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-card",{staticClass:"box-card-1"},[o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("el-card",{staticClass:"box-card"},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("选择前景图像")])]),o("div",{staticClass:"text-center"},[o("el-upload",{staticClass:"upload-demo",attrs:{action:t.uploadAction,"on-remove":t.removeForeground,"file-list":t.foregroundList,"on-change":t.handleFrontgroundChange,"list-type":"picture-card","before-upload":t.beforeFrontgroundUpload,"auto-upload":!1,"on-success":t.handleForegroundSuccess,accept:"image/*"}},[o("i",{staticClass:"el-icon-plus"})])],1),t._l(t.foregroundList,(function(t,e){return o("div",{key:"foreground"+e,staticClass:"image-preview"})}))],2)],1),o("el-col",{attrs:{span:12}},[o("el-card",{staticClass:"box-card"},[o("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[o("span",[t._v("选择背景图像")])]),o("div",{staticClass:"text-center"},[o("el-upload",{staticClass:"upload-demo",attrs:{action:t.uploadAction,"on-change":t.handleBackgroundChange,"file-list":t.backgroundList,"show-file-list":!0,"list-type":"picture-card","before-upload":t.beforeBackgroundUpload,"on-success":t.handleBackgroundSuccess,"auto-upload":!1,accept:"image/*","on-exceed":t.handleExceed}},[o("i",{staticClass:"el-icon-plus"})])],1),t.backgroundList.length>0?o("div",{staticClass:"image-preview"}):t._e()])],1)],1),o("div",{staticClass:"text-center button-container"},[o("el-button",{attrs:{type:"primary"},on:{click:t.openImagesWindow}},[t._v("合成图像")]),o("el-dialog",{attrs:{title:"合成图像",visible:t.isR},on:{"update:visible":function(e){t.isR=e}}},[o("div",{staticStyle:{display:"flex"}},[o("div",{staticClass:"image-editor",staticStyle:{width:"75%",height:"auto"}},[o("div",{staticClass:"background",staticStyle:{width:"100%",height:"auto"},on:{click:t.deselectForeground}}),o("div",{staticClass:"foreground-container",staticStyle:{width:"100%",height:"auto"}},[o("img",{staticStyle:{position:"absolute",left:"0","max-width":"100%","max-height":"100%"},attrs:{id:"backImg",src:t.uploadImageUrl,alt:"背景图片"}}),t._l(t.selectedForeImg,(function(e,i){return o("div",{key:i,staticClass:"foreImg-wrapper",class:{foreImg:!0,selected:t.selectedImageIndex===i,highlighted:t.selectedImageIndex===i},style:{zIndex:t.selectedImageIndex===i?1:0,left:"0px",top:"0px"},attrs:{id:"foreImg"+i},on:{mousedown:function(e){return t.startDrag(e,i)}}},[o("img",{staticClass:"foreImg",style:{transformOrigin:"top left"},attrs:{src:e}}),o("div",{staticClass:"delete-button",on:{click:function(e){return t.deleteImage(i)}}},[t._v("×")])])}))],2)]),o("div",{staticClass:"image-editor",staticStyle:{width:"25%"}},[o("span",[t._v("前景图像列表")]),t._l(t.foregroundList,(function(e,i){return o("div",{key:i,on:{click:function(e){return t.selectForeground(i)}}},[o("img",{staticStyle:{width:"100%",height:"auto"},attrs:{src:e.url,alt:"Image"}})])}))],2)]),o("el-button",{attrs:{type:"primary"},on:{click:t.combineImages}},[t._v("合成图像")])],1)],1),t.isCombining?o("div",{staticClass:"progress-box"},[t._v(" 合成中，请稍候... "),o("el-progress",{attrs:{percentage:t.progressPercentage,status:t.progressStatus}})],1):t._e(),t.isCombiningSuccess?o("div",[t._v(" 合成成功！ ")]):t._e(),t.isCombiningSuccess?o("div",{staticClass:"combined-image-container"},[o("img",{attrs:{src:t.combinedImageUrl,alt:"Combined Image"}}),o("el-button",{attrs:{type:"primary"},on:{click:t.downloadCombinedImage}},[t._v("下载图片")]),o("el-button",{attrs:{type:"primary"},on:{click:t.editImages}},[t._v("再次编辑")])],1):t._e()],1)},s=[],n=(o("a434"),o("d3b7"),o("159b"),o("99af"),o("b0c0"),o("3ca3"),o("ddb0"),o("2b3d"),o("9861"),o("e9c4"),o("ace4"),o("5cc6"),o("9a8c"),o("a975"),o("735e"),o("c1ac"),o("d139"),o("3a7b"),o("d5d6"),o("82f8"),o("e91f"),o("60bd"),o("5f96"),o("3280"),o("3fcc"),o("ca91"),o("25a1"),o("cd26"),o("3c5d"),o("2954"),o("649e"),o("219c"),o("170b"),o("b39a"),o("72f7"),{data:function(){return{selectedImageIndex:null,uploadAction:"//jsonplaceholder.typicode.com/posts/",foregroundList:[],files:[],backFile:[],currentForeImg:0,backgroundList:[],isSelected:[],scale:1,isR:!1,url:{},length:0,selectedForegroundIndex:0,isMouseDown:!1,startForeImgX:0,startForeImgY:0,isSame:-1,startX:0,startY:0,ForeImgX:0,ForeImgY:0,showForeImg:"",selectedForeImg:[],foregroundImages:["src/th.jpg","src/th.jpg"],uploadImageUrl:"",isCombining:!1,isCombiningSuccess:!1,progressPercentage:0,progressStatus:"active",combinedImageUrl:null,position:[],positionRightDown:[0,0,0,0],showUploadButton:!0,backImgSize:[]}},mounted:function(){var t=1,e=document.getElementById("foreImg"+this.currentForeImg);console.log("foreImg:",e),e.onwheel=function(o){o.deltaY>0?t+=.05:t-=.05,t=Math.min(Math.max(.1,t),5),e.style.transform="scale(".concat(t,")")}},methods:{deleteImage:function(t){this.selectedForeImg.splice(t,1),this.files.splice(t,1),this.position=[0,0]},openImagesWindow:function(){console.log("前景图像:",this.foregroundList),console.log("uploadImageUrl",this.uploadImageUrl),this.foregroundList.forEach((function(t){console.log("文件名: ".concat(t.name,", URL: ").concat(t.url))})),console.log("背景图像:"),this.backgroundList.forEach((function(t){console.log("文件名: ".concat(t.name,", URL: ").concat(t.url))})),this.isR=!0},selectForeground:function(t){this.url[this.length]=this.foregroundList[t].url,this.position=[0,0],this.files.push(this.foregroundList[t].file),this.selectedForeImg.push(this.foregroundList[t].url),console.log("file:::",this.foregroundList[t].file.raw),this.length++},deselectForeground:function(){this.selectedForegroundIndex=null},startDrag:function(t,e){var o=this;this.currentForeImg=e,this.isSame!==e&&(this.startForeImgX=this.position[0],this.startForeImgY=this.position[1],this.ForeImgX=this.startForeImgX,this.ForeImgY=this.startForeImgY),this.isSame=e,console.log("this.positionStart:",this.position),this.highlightedIndex=e,console.log("event,",t),this.isMouseDown=!0,t.preventDefault();var i=document.getElementById("backImg"),s=i.getBoundingClientRect();this.backImgSize[0]=s.width,this.backImgSize[1]=s.height,console.log("rectBack:",s.height,s.width);var n=t.target,r=i.getBoundingClientRect(),a=n.getBoundingClientRect();console.log("rect:",a),this.startX=t.clientX,this.startY=t.clientY,document.onmousemove=function(t){!0===o.isMouseDown&&(console.log("开始拖拽"),i&&(o.ForeImgX=t.clientX-o.startX+o.startForeImgX,o.ForeImgY=t.clientY-o.startY+o.startForeImgY,o.ForeImgX<0-r.width?o.ForeImgX=0:o.ForeImgX+a.width>r.width+r.width&&(o.ForeImgX=r.width-a.width),o.ForeImgY<0-r.height?o.ForeImgY=0:o.ForeImgY+a.height>r.height+r.height&&(o.ForeImgY=r.height-a.height),console.log("rect.width:",a.width,a.height),o.position=[o.ForeImgX,o.ForeImgY],o.positionRightDown=[o.position[0],o.position[1],o.position[0]+a.width,o.position[1]+a.height],console.log("onmousedown, position",o.positionRightDown),console.log("this.position",o.position),o.$el.querySelector("#foreImg".concat(e)).style.left=o.position[0]+"px",o.$el.querySelector("#foreImg".concat(e)).style.top=o.position[1]+"px"))},document.onmouseup=function(t){o.startForeImgX=o.ForeImgX,o.startForeImgY=o.ForeImgY,console.log("停止拖拽"),o.isMouseDown=!1},document.onwheel=function(t){t.deltaY>0?o.scale+=.05:o.scale-=.05,o.scale=Math.min(Math.max(.1,o.scale),5),o.$el.querySelector("#foreImg".concat(e)).style.transform="scale(".concat(o.scale,")"),console.log("this.position:",o.position);var i=n.getBoundingClientRect();o.positionRightDown=[o.position[0],o.position[1],o.position[0]+i.width,o.position[1]+i.height],console.log("onwheel, position",i.width,i.height,a.width,a.height,o.positionRightDown)},this.selectedImageIndex=e},handleForegroundSuccess:function(t,e){this.foregroundList=[{name:e.name,url:URL.createObjectURL(e.raw)}],console.log("前景图片列表",this.foregroundList)},handleBackgroundSuccess:function(t,e){this.backgroundList=[{name:e.name,url:URL.createObjectURL(e.raw)}],this.showUploadButton=!1},handleRemove:function(t,e){},removeForeground:function(t){this.foregroundList.splice(t,1)},removeBackground:function(t){this.backgroundList.splice(t,1),this.backFile.splice(t,1),this.showUploadButton=!0},submitUpload:function(t){"background"===t&&this.$refs.uploadBackground.submit(),"frontground"===t&&this.$refs.uploadFrontground.submit()},handlePreview:function(t){window.open(t.url)},beforeBackgroundUpload:function(){return console.log("搜索视频",this.backgroundList),!(this.backgroundList.length>=1)||(this.$message.error("只能添加一张背景图像"),!1)},beforeFrontgroundUpload:function(){return console.log("搜索视频",this.foregroundList),!0},handleFrontgroundChange:function(t,e){this.foregroundList.push({name:t.name,url:URL.createObjectURL(t.raw),file:t}),console.log(this.foregroundList[0].url)},handleBackgroundChange:function(t,e){this.backFile.push(t),this.backgroundList=[{name:t.name,url:URL.createObjectURL(t.raw)}];var o=e[e.length-1];console.log(o.url),o&&o.url&&(this.uploadImageUrl=o.url)},combineImages:function(){var t=this;if(this.progressPercentage=0,this.progressStatus="active",0===this.positionRightDown[0]||0===this.positionRightDown[1]||0===this.positionRightDown[2]||0===this.positionRightDown[3]){var e=new Image;e.src=this.selectedForeImg[0],console.log("imgSrc:",e.src,e.height,e.width),this.positionRightDown[0]=0,this.positionRightDown[1]=0,this.positionRightDown[2]=e.width,this.positionRightDown[3]=e.height,console.log("positionSSSSS",this.positionRightDown)}this.isCombining=!0,this.isCombiningSuccess=!1,this.combinedImageUrl=null,this.foregroundList.forEach((function(t){console.log("文件名: ".concat(t.name,", URL: ").concat(t.url))})),console.log("背景图像:"),this.backgroundList.forEach((function(t){console.log("文件名: ".concat(t.name,", URL: ").concat(t.url))})),this.isR=!1;var o=setInterval((function(){t.progressPercentage<200?t.progressPercentage+=10:(clearInterval(o),t.progressStatus="success",t.isCombiningSuccess=!0,t.isCombining=!1)}),1e3),i=document.getElementById("backImg").naturalWidth,s=document.getElementById("backImg").naturalHeight,n=[i*this.positionRightDown[0]/this.backImgSize[0],s*this.positionRightDown[1]/this.backImgSize[1],i*this.positionRightDown[2]/this.backImgSize[0],s*this.positionRightDown[3]/this.backImgSize[1]],r=new FormData;console.log("this.files[0].raw:",this.files[0].raw),r.append("foreground",this.files[0].raw),r.append("background",this.backFile[0].raw),r.append("bbox",JSON.stringify(n)),console.log("JSON:",JSON.stringify(n)),console.log("formData:",r.keys),this.$store.dispatch("systemconfig/postPos",r).then((function(e){t.combinedImageUrl="data:image/jpg;base64,"+e.data,console.log("response:",e.data)})).catch((function(t){console.error("获取根目录失败:",t)}))},handleExceed:function(t){this.$message({type:"warning",message:"只能上传一个文件!"})},downloadCombinedImage:function(){this.combinedImageUrl&&fetch(this.combinedImageUrl).then((function(t){if(t.ok)return t.blob();throw new Error("Network response was not ok.")})).then((function(t){var e=window.URL.createObjectURL(t),o=document.createElement("a");o.href=e,o.download="combined-image.png",document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(e)})).catch((function(t){console.error("There was a problem with the fetch operation:",t)}))},editImages:function(){this.isR=!0},getBase64:function(t){return new Promise((function(e,o){var i=new FileReader,s="";i.readAsDataURL(t),i.onload=function(){s=i.result},i.onerror=function(t){o(t)},i.onloadend=function(){e(s)}}))},dataURLtoFile:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"application/octet-stream",o=window.atob(t),i=o.length,s=new Uint8Array(i);while(i--)s[i]=o.charCodeAt(i);return new Blob([s],{type:e})}}}),r=n,a=(o("1d35"),o("2877")),c=Object(a["a"])(r,i,s,!1,null,"4ac96ef7",null);e["default"]=c.exports}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2cf38b36"],{"4fa2":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"container"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",[e._v("实时预览")])]),n("div",[n("el-select",{attrs:{placeholder:"请选择"},on:{change:e.viewMethodChange},model:{value:e.viewMethod,callback:function(t){e.viewMethod=t},expression:"viewMethod"}},e._l(e.options,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("el-row",[n("el-col",{attrs:{span:24}},[n("el-row",[n("el-col",{style:e.image_style,attrs:{span:24,type:"flex",align:"middle"}},[n("img",{attrs:{id:"cameraStream",src:"",alt:"无视频输入",height:e.screenHeight},on:{click:e.toggleFullScreen}})])],1)],1)],1)],1)},r=[],c=(n("d3b7"),n("25f0"),n("3ca3"),n("ddb0"),n("2b3d"),n("bf19"),n("9861"),n("fec4"),n("5c96")),a={name:"RealTimeVideo",data:function(){return{imageSrc:"",socket:null,isPause:!0,label_dicts:[],image_src:"data:image/jpeg;base64,",screenWidth:5/7*window.innerWidth,screenHeight:5/7*window.innerHeight,imageWidth:this.screenWidth/4,imageHeight:this.screenHeight/5,image_style:"height:"+this.screenWidth+"px;",options:[{label:"上视角",value:0},{label:"下视角",value:1},{label:"双视角",value:2}],viewMethod:2,detected_Status:!1,currentBlobUrl:null}},created:function(){},mounted:function(){this.image_src="data:image/jpeg;base64,",this.screenWidth=5/7*window.innerWidth,this.screenHeight=5/7*window.innerHeight,this.imageWidth=this.screenWidth/6,this.imageHeight=this.screenHeight/5,this.image_style="height:"+this.screenHeight+"px",this.getConfig(),this.timer=null},beforeDestroy:function(){clearInterval(this.timer),this.currentBlobUrl&&URL.revokeObjectURL(this.currentBlobUrl)},destroyed:function(){clearInterval(this.timer)},methods:{getConfig:function(){var e=this;this.$store.dispatch("systemconfig/getConfig").then((function(t){200===t.status?(e.detected_Status=0===t.data.detected_status,e.input_view=t.data.input_view,e.detected_Status?e.setInterval2():null!=e.timer&&(clearInterval(e.timer),e.timer=null)):Object(c["Message"])({message:t.message,type:"error",duration:3e3})})).catch((function(e){console.error("获取配置信息失败:",e)}))},setInterval:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){var e=this,t=1e3,n=this.screenHeight,i="/realTimeVideo/videoStream",r=50,c=document.getElementById("canvas"),a=c.getContext("2d"),l=new Image,s=document.createElement("canvas"),o=s.getContext("2d"),h=null;this.timer=setInterval((function(){h&&h.abort(),h=new AbortController,fetch(i,{signal:h.signal}).then((function(e){return e.blob()})).then((function(i){URL.revokeObjectURL(l.src),l=new Image;var r=e.viewMethod;l.src=URL.createObjectURL(i),l.onload=function(){var e=Math.min(t/l.width,n/l.height);if(2===r){var i=l.width*e,h=l.height*e;return l.width=i,l.height=h,c.width=i,c.height=h,void a.drawImage(l,0,0,l.width,l.height)}s.width=l.width,s.height=l.height;var u=0,d=1;0===r?(u=0,d=2):1===r&&(u=l.height/2,d=2),o.drawImage(l,0,0),e=Math.min(t/l.width,n/l.height*d);var m=l.width*e,g=l.height*e,f=o.getImageData(0,u,l.width,l.height/d);c.width=m,c.height=g,a.putImageData(f,0,0)}})).catch((function(e){console.error("Error fetching camera stream:",e)}))}),r)})),setInterval2:function(){var e=this,t=document.getElementById("cameraStream"),n="/realTimeVideo/videoStream",i=50;this.timer=setInterval((function(){var i=e.viewMethod;fetch(n+"?viewMethod="+i).then((function(e){return e.blob()})).then((function(n){e.currentBlobUrl&&URL.revokeObjectURL(e.currentBlobUrl),e.currentBlobUrl=URL.createObjectURL(n),t.src=e.currentBlobUrl})).catch((function(e){console.error("Error fetching camera stream:",e)}))}),i)},toggleFullScreen:function(){var e=document.getElementById("cameraStream");document.fullscreenElement?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},viewMethodChange:function(){}}},l=a,s=(n("ac08"),n("2877")),o=Object(s["a"])(l,i,r,!1,null,"2c7328ce",null);t["default"]=o.exports},8596:function(e,t,n){},ac08:function(e,t,n){"use strict";n("8596")}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4016acbf"],{"4a75":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",{staticClass:"box-card"},[s("el-row",[s("el-col",{attrs:{span:24}},[s("el-card",{staticClass:"box-card"},[s("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"},attrs:{slot:"header"},slot:"header"},[s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("el-autocomplete",{attrs:{"fetch-suggestions":e.querySearchUser,placeholder:"请输入查询用户名称"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"dropdown-item",fn:function(t){var r=t.item;return[s("div",[e._v(e._s(r.realName))])]}}]),model:{value:e.state,callback:function(t){e.state=t},expression:"state"}}),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.resetSearch}},[e._v("重置")])],1),s("div",{staticStyle:{"margin-left":"auto"}},[s("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.showAdd}},[e._v("添加用户")])],1),s("div",e._l(e.userList,(function(t){return s("div",{key:t.id},[e._v(" "+e._s(t.name)+" ")])})),0)]),s("el-table",{ref:"userTable",staticStyle:{width:"100%"},attrs:{data:e.userList}},[s("el-table-column",{attrs:{type:"selection"}}),s("el-table-column",{attrs:{type:"index",label:"序号"}}),s("el-table-column",{attrs:{label:"权限",prop:"role"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"===t.row.role?s("span",[e._v("管理员")]):s("span",[e._v("普通用户")])]}}])}),s("el-table-column",{attrs:{label:"用户名",prop:"username"}}),s("el-table-column",{attrs:{label:"真实姓名",prop:"realName"}}),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[s("div",{staticStyle:{display:"flex","justify-content":"space-around"}},[s("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.showEdit(r.id)}}},[e._v("编辑")]),s("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(t){return e.confirmResetPassword(r.id)}}},[e._v("重置密码")]),"admin"!==r.username?s("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.confirmRemove(r.id)}}},[e._v("删除")]):e._e()],1)]}}])}),e._e()],1),s("el-pagination",{attrs:{"current-page":e.query.pageNum,"page-sizes":[10,20,30,40],"page-size":e.query.pageSize,layout:"total, sizes, prev, pager, next, jumper",background:"True",total:e.query.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1),s("el-dialog",{attrs:{visible:e.resetPasswordDialogVisible,title:"确认重置密码"},on:{"update:visible":function(t){e.resetPasswordDialogVisible=t}}},[s("span",[e._v("确定要重置该用户的密码吗？")]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.resetPasswordDialogVisible=!1}}},[e._v("取消")]),s("el-button",{attrs:{type:"warning"},on:{click:function(t){return e.resetPassword(e.confirmRow.id)}}},[e._v("确定")])],1)]),s("el-dialog",{attrs:{visible:e.removeDialogVisible,title:"确认删除用户"},on:{"update:visible":function(t){e.removeDialogVisible=t}}},[s("span",[e._v("确定要删除该用户吗？此操作不可恢复。")]),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.removeDialogVisible=!1}}},[e._v("取消")]),s("el-button",{attrs:{type:"danger"},on:{click:function(t){return e.remove(e.confirmRow.id)}}},[e._v("确定")])],1)]),s("el-dialog",{attrs:{title:"添加新用户",visible:e.showAddModal,width:"50%",top:"20px","append-to-body":""},on:{"update:visible":function(t){e.showAddModal=t}}},[s("div",{staticClass:"modal-body"},[s("el-form",{ref:"form",attrs:{model:e.userInfo,rules:e.rules,novalidate:""}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-xs-12"},[s("el-form-item",{attrs:{prop:"username",label:"用户名"}},[s("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.userInfo.username,callback:function(t){e.$set(e.userInfo,"username",t)},expression:"userInfo.username"}})],1),s("el-form-item",{attrs:{prop:"realName",label:"真实姓名"}},[s("el-input",{attrs:{placeholder:"请输入真实姓名"},model:{value:e.userInfo.realName,callback:function(t){e.$set(e.userInfo,"realName",t)},expression:"userInfo.realName"}})],1),s("el-form-item",{attrs:{prop:"password",label:"密码"}},[s("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.userInfo.password,callback:function(t){e.$set(e.userInfo,"password",t)},expression:"userInfo.password"}})],1),s("el-form-item",{attrs:{prop:"confirmPassword",label:"确认密码"}},[s("el-input",{attrs:{type:"password",placeholder:"请确认密码"},model:{value:e.userInfo.confirmPassword,callback:function(t){e.$set(e.userInfo,"confirmPassword",t)},expression:"userInfo.confirmPassword"}})],1),s("el-form-item",{attrs:{label:"是否为管理员"}},[s("el-radio-group",{model:{value:e.userInfo.role,callback:function(t){e.$set(e.userInfo,"role",t)},expression:"userInfo.role"}},[e._v("--\x3e "),s("el-radio",{attrs:{label:1}},[e._v("是")]),s("el-radio",{attrs:{label:2}},[e._v("否")])],1)],1)],1)])])],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showAddModal=!1}}},[e._v("取消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.submitFormCreateUser}},[e._v("确认")])],1)]),s("el-dialog",{attrs:{title:"编辑用户信息",visible:e.showEditModal,width:"50%",top:"20px","append-to-body":""},on:{"update:visible":function(t){e.showEditModal=t}}},[s("div",{staticClass:"modal-body"},[s("el-form",{ref:"form",attrs:{model:e.userInfo,rules:e.simpleRules,novalidate:""}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-xs-12"},[s("el-form-item",{attrs:{prop:"realName",label:"真实姓名"}},[s("el-input",{attrs:{placeholder:"请输入真实姓名"},model:{value:e.userInfo.realName,callback:function(t){e.$set(e.userInfo,"realName",t)},expression:"userInfo.realName"}})],1),s("el-form-item",{attrs:{prop:"password",label:"密码"}},[s("el-input",{attrs:{type:"password",placeholder:"请输入密码"},model:{value:e.userInfo.password,callback:function(t){e.$set(e.userInfo,"password",t)},expression:"userInfo.password"}})],1),s("el-form-item",{attrs:{prop:"confirmPassword",label:"确认密码"}},[s("el-input",{attrs:{type:"password",placeholder:"请确认密码"},model:{value:e.userInfo.confirmPassword,callback:function(t){e.$set(e.userInfo,"confirmPassword",t)},expression:"userInfo.confirmPassword"}})],1),s("el-form-item",{attrs:{label:"是否为管理员"}},[s("el-radio-group",{model:{value:e.userInfo.role,callback:function(t){e.$set(e.userInfo,"role",t)},expression:"userInfo.role"}},[s("el-radio",{attrs:{label:"1"}},[e._v("是")]),s("el-radio",{attrs:{label:"2"}},[e._v("否")])],1)],1)],1)])])],1),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showEditModal=!1}}},[e._v("取消")]),s("el-button",{attrs:{type:"primary"},on:{click:e.submitFormEditUser}},[e._v("确认")])],1)])],1)},o=[],a=s("c7eb"),n=s("1da1"),i=(s("d81d"),s("d3b7"),s("4de4"),s("caad"),s("2532"),s("c24f")),l=s("5c96"),c={data:function(){return{state:null,showAddModal:!1,showEditModal:!1,passwordConfirm:null,userInfo:{id:"",role:"",username:"",realName:"",password:"",confirmPassword:""},resetPasswordDialogVisible:!1,removeDialogVisible:!1,confirmRow:{},rules:{username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],realName:[{required:!0,message:"真实姓名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],confirmPassword:[{required:!0,message:"确认密码不能为空",trigger:"blur"},{validator:this.validateConfirmPassword,trigger:"blur"}]},simpleRules:{realName:[{required:!0,message:"真实姓名不能为空",trigger:"blur"}],confirmPassword:[{validator:this.validateConfirmPassword,trigger:"blur"}]},userList:[],query:{pageNum:1,pageSize:10,total:0}}},created:function(){this.fetchUserList()},methods:{confirmRemove:function(e){var t=this;this.confirmRow=e,this.$confirm("是否确认该操作","提示",{iconClass:"el-icon-question",confirmButtonText:"确认",cancelButtonText:"取消",showClose:!0,type:"warning"}).then((function(){t.remove(e)})).catch((function(){}))},confirmResetPassword:function(e){var t=this;this.$confirm("是否确认该操作","提示",{iconClass:"el-icon-question",confirmButtonText:"确认",cancelButtonText:"取消",showClose:!0,type:"warning"}).then((function(){t.resetPassword(e)})).catch((function(){}))},resetSearch:function(){this.state="",this.fetchUserList()},getGenderLabel:function(e){return 1===e?"男":"女"},showAdd:function(){this.userInfo={realName:"",password:"",confirmPassword:""},this.showAddModal=!0},submitFormEditUser:function(){var e=this;this.$refs.form.validate((function(t){return t?(console.log("表单数据",e.userInfo),void 0===e.userInfo.password||null===e.userInfo.password?(e.userInfo.password="",void e.editUser()):void(e.userInfo.password.length<6?Object(l["Message"])({message:"密码不能小于6位数",type:"error",duration:3e3}):(e.editUser(),e.showEditModal=!1))):(console.error("表单校验失败"),!1)}))},querySearchUser:function(e,t){if(e)this.getUsersSuggestions(e).then((function(e){t(e)}));else{var s=this.userList.map((function(e){return{value:e.username}}));t(s)}},getUsersSuggestions:function(e){var t=this;return new Promise((function(s){var r=t.userList.filter((function(t){return t.username.toLowerCase().includes(e.toLowerCase())})),o=r.map((function(e){return{value:e.username}}));s(o)}))},handleSelect:function(e){var t=this;return Object(n["a"])(Object(a["a"])().mark((function s(){return Object(a["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.$set(t.userInfo,"username",e.value),s.next=3,t.fetchUserList(t.userInfo);case 3:console.log(t.userList),t.$refs.userTable.clearSelection(),t.$refs.userTable.setCurrentRow();case 6:case"end":return s.stop()}}),s)})))()},validateConfirmPassword:function(e,t,s){void 0===t&&(t=null),t!==this.userInfo.password?s(new Error("确认密码和密码不匹配")):s()},submitFormCreateUser:function(){var e=this;this.userInfo.password.length<6?Object(l["Message"])({message:"密码不能小于6位数",type:"error",duration:3e3}):this.$refs.form.validate((function(t){if(!t)return console.error("表单验证失败"),!1;console.log("表单验证成功，提交表单"),e.createUser()}))},createUser:function(){var e=this;this.userInfo.realName&&Object(i["a"])(this.userInfo).then((function(t){200===t.status?(Object(l["Message"])({message:"操作成功",type:"success",duration:3e3}),e.fetchUserList()):Object(l["Message"])({message:t.message,type:"error",duration:3e3})})).catch((function(e){console.log(e),l["Message"].error("操作失败")})),this.showAddModal=!1},editUser:function(){var e=this;Object(i["c"])(this.userInfo).then((function(t){200===t.status?(Object(l["Message"])({message:"操作成功",type:"success",duration:3e3}),e.fetchUserList()):Object(l["Message"])({message:t.message,type:"error",duration:3e3})})).catch((function(e){console.log(e),l["Message"].error("操作失败")})),this.showEditModal=!1},showEdit:function(e){console.log("id:"+e),this.getUser(e),this.userInfo.id=e,this.showEditModal=!0},resetPassword:function(e){Object(i["j"])(e).then((function(e){200===e.status?Object(l["Message"])({message:"重置密码成功！",type:"success",duration:3e3}):Object(l["Message"])({message:e.message,type:"error",duration:3e3})})).catch((function(e){console.log(e),l["Message"].error("重置失败！")}))},remove:function(e){var t=this;console.log(e),Object(i["b"])(e).then((function(e){200===e.status?(Object(l["Message"])({message:"删除用户成功！",type:"success",duration:3e3}),t.fetchUserList()):Object(l["Message"])({message:e.message,type:"error",duration:3e3})})).catch((function(e){console.log(e),l["Message"].error("删除失败！")}))},handleSizeChange:function(e){this.query.pageSize=e,this.fetchUserList()},handleCurrentChange:function(e){this.query.pageNum=e,this.fetchUserList()},fetchUserList:function(e){var t=this;return Object(n["a"])(Object(a["a"])().mark((function s(){var r,o;return Object(a["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,r={pageNum:t.query.pageNum,pageSize:t.query.pageSize},console.log(e),console.log(r),s.next=6,Object(i["g"])(e,r);case 6:if(o=s.sent,200!==o.status){s.next=12;break}t.userList=o.pageInfo.list,o.pageInfo.pageNum&&o.pageInfo.pageSize&&o.pageInfo.total?(t.query.pageNum=o.pageInfo.pageNum,t.query.pageSize=o.pageInfo.pageSize,t.query.total=o.pageInfo.total):(t.query.pageNum=1,t.query.pageSize=10,t.total=0),s.next=14;break;case 12:return Object(l["Message"])({message:o.message,type:"error",duration:3e3}),s.abrupt("return");case 14:s.next=20;break;case 16:throw s.prev=16,s.t0=s["catch"](0),console.error("获取用户列表失败：",s.t0),s.t0;case 20:case"end":return s.stop()}}),s,null,[[0,16]])})))()},getUser:function(e){var t=this;return Object(n["a"])(Object(a["a"])().mark((function s(){var r;return Object(a["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Object(i["f"])(e);case 3:r=s.sent,t.userInfo=r.data,s.next=11;break;case 7:throw s.prev=7,s.t0=s["catch"](0),console.error("获取用户失败：",s.t0),s.t0;case 11:case"end":return s.stop()}}),s,null,[[0,7]])})))()}}},u=c,d=(s("8711"),s("2877")),f=Object(d["a"])(u,r,o,!1,null,"44f54707",null);t["default"]=f.exports},8711:function(e,t,s){"use strict";s("bb77")},bb77:function(e,t,s){}}]);
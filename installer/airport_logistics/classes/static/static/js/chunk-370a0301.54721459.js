(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-370a0301"],{c01d:function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"app-container"},[s("el-form",{ref:"formRef",attrs:{model:t.form,"label-width":"120px",rules:t.rules}},[s("el-form-item",{attrs:{label:"输入源配置",prop:"input_type"}},[s("el-select",{attrs:{placeholder:"请选择输入源"},model:{value:t.form.input_type,callback:function(e){t.$set(t.form,"input_type",e)},expression:"form.input_type"}},[s("el-option",{attrs:{label:"USB摄像头",value:"0"}}),s("el-option",{attrs:{label:"视频流",value:"1"}}),s("el-option",{attrs:{label:"网络摄像头",value:"2"}})],1),s("el-input",{staticStyle:{width:"300px","margin-left":"10px"},attrs:{placeholder:"输入源配置",prop:"source"},model:{value:t.form.source,callback:function(e){t.$set(t.form,"source",e)},expression:"form.source"}})],1),s("el-form-item",{attrs:{label:"输入视角配置"}},[s("el-radio-group",{attrs:{prop:"input_view"},on:{change:t.changeInputview},model:{value:t.form.input_view,callback:function(e){t.$set(t.form,"input_view",e)},expression:"form.input_view"}},[s("el-radio",{attrs:{label:1}},[t._v("单视角")])],1)],1),s("div",{staticClass:"canvas-container"},[s("canvas",{ref:"imageCanvas",staticClass:"image-canvas",attrs:{width:"512",height:"512"}}),s("canvas",{ref:"drawCanvas",staticClass:"draw-canvas",attrs:{width:"512",height:"512"},on:{mousedown:t.startDrawing,mousemove:t.draw,mouseup:t.endDrawing,mouseleave:t.endDrawing}})]),s("el-form-item",{staticClass:"button-container"},[s("el-button",{attrs:{type:"primary"},on:{click:t.captureImage}},[t._v("捕获")]),s("el-button",{attrs:{type:"primary"},on:{click:t.openDrawing}},[t._v("绘制检测区域")]),s("el-button",{attrs:{type:"danger"},on:{click:t.clearBoxes}},[t._v("清除")]),s("el-button",{attrs:{type:"success"},on:{click:t.saveBoxes}},[t._v("保存")])],1),s("el-form-item",{attrs:{label:"检测阈值配置",prop:"threshold"}},[s("el-input-number",{staticStyle:{width:"300px"},attrs:{placeholder:"检测阈值输入",min:0,max:1,step:.1},model:{value:t.form.threshold,callback:function(e){t.$set(t.form,"threshold",t._n(e))},expression:"form.threshold"}}),s("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.updateThreshold}},[t._v("保存")])],1),s("el-form-item",{attrs:{label:"是否开始检测"}},[s("el-switch",{on:{change:t.updateStatus},model:{value:t.detected_Status,callback:function(e){t.detected_Status=e},expression:"detected_Status"}})],1)],1)],1)])},a=[],i=(s("d3b7"),s("25f0"),s("fb6a"),s("159b"),s("5c96")),o={data:function(){return{tempData:"",form:{input_type:"",source:"",input_view:1,threshold:.5,boxes:[]},rules:{input_type:[{required:!0,message:"请选择输入源",trigger:"blur"}],source:[{required:!0,message:"请输入输入源配置",trigger:"blur"}],input_view:[{required:!0,message:"请选择输入视角配置",trigger:"change"}],threshold:[{required:!0,message:"请输入检测阈值",trigger:"blur"},{validator:function(t,e,s){"number"!==typeof e||e<0||e>1?s(new Error("检测阈值必须在 0 到 1 之间")):s()},trigger:"blur"}]},scale:null,detected_Status:!1,imageSrc:null,isDrawing:!1,currentBox:null}},created:function(){this.getConfig()},methods:{getConfig:function(){var t=this;this.$store.dispatch("systemconfig/getConfig").then((function(e){200===e.status?(t.tempData=e.data,t.form.threshold=t.tempData.threshold,t.detected_Status=0===t.tempData.status,t.form.input_type=t.tempData.input_type.toString(),t.form.source=t.tempData.source,t.form.input_view=t.tempData.input_view,Object(i["Message"])({message:e.message,type:"success",duration:3e3})):Object(i["Message"])({message:e.message,type:"error",duration:3e3})})).catch((function(t){console.error("获取配置信息失败:",t)}))},captureImage:function(){var t=this,e={input_type:this.form.input_type,source:this.form.source,input_view:this.form.input_view};""!==this.form.source&&null!==this.form.source?this.$store.dispatch("systemconfig/capture",e).then((function(e){200===e.status?(t.imageSrc="data:image/jpg;base64,"+e.data,t.drawImage(t.imageSrc),Object(i["Message"])({message:e.message,type:"success",duration:3e3})):Object(i["Message"])({message:e.message,type:"error",duration:3e3})})).catch((function(t){console.error("获取图像失败:",t)})):Object(i["Message"])({message:"请输入来源",type:"error",duration:3e3})},drawImage:function(t){var e=this,s=this.$refs.imageCanvas,r=s.getContext("2d"),a=new Image;a.src=t,a.onload=function(){var t=null;t=s.width>a.width?Math.min(s.width/a.width,s.height/a.height):Math.min(a.width/s.width,a.height/s.height),e.scale=t,r.drawImage(a,0,0,a.width/t,a.height/t)}},openDrawing:function(){this.isDrawing=!0},startDrawing:function(t){this.form.boxes.length>=(1===this.form.input_view?1:2)?this.$message({message:"已达最大绘制数量",type:"warning"}):(this.currentBox={startX:t.offsetX,startY:t.offsetY},this.isDrawing=!0)},draw:function(t){if(this.isDrawing&&this.currentBox){var e=this.$refs.drawCanvas,s=e.getContext("2d");s.clearRect(this.currentBox.startX,this.currentBox.startY,t.offsetX-this.currentBox.startX,t.offsetY-this.currentBox.startY),s.beginPath(),s.rect(this.currentBox.startX,this.currentBox.startY,t.offsetX-this.currentBox.startX,t.offsetY-this.currentBox.startY),s.stroke()}},endDrawing:function(t){if(this.isDrawing&&this.currentBox){var e=this.$refs.drawCanvas.getContext("2d");e.stroke(),this.form.boxes.push({x1:this.currentBox.startX,y1:this.currentBox.startY,width:t.offsetX-this.currentBox.startX,height:t.offsetY-this.currentBox.startY}),this.redraw(),this.isDrawing=!1,this.currentBox=null}},clearBoxes:function(){this.form.boxes=[],this.isDrawing=!1,this.currentBox=null;var t=this.$refs.drawCanvas.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height)},saveBoxes:function(){var t=this;this.$refs.formRef.validate((function(e){if(!e)return console.log("表单验证失败"),!1;if(0!==t.form.boxes.length){for(var s=[],r=0;r<t.form.boxes.length;r++){s[r]=[];var a=t.form.boxes[r];s[r][0]=a.x1*t.scale,s[r][1]=a.y1*t.scale,s[r][2]=a.width*t.scale,s[r][3]=a.height*t.scale}var o={input_type:t.form.input_type,source:t.form.source,input_view:t.form.input_view,points:s};console.log("Sending data:",o),t.$store.dispatch("systemconfig/saveInput",o).then((function(t){200===t.status?Object(i["Message"])({message:"保存系统配置成功，重启检测开关生效",type:"success",duration:3e3}):Object(i["Message"])({message:t.message,type:"error",duration:3e3})})).catch((function(t){console.error("保存失败:",t)}))}else t.$message({message:"请先绘制检测区域",type:"error",duration:3e3})}))},updateThreshold:function(){var t=this;this.$refs.formRef.validateField("threshold",(function(e){if(e)return console.log("阈值验证失败"),!1;t.$store.dispatch("systemconfig/updateThreshold",t.form.threshold).then((function(t){console.log(t),200===t.status?Object(i["Message"])({message:"修改成功",type:"success",duration:3e3}):Object(i["Message"])({message:t.message,type:"error",duration:3e3})})).catch((function(t){console.error("保存失败:",t)}))}))},updateStatus:function(){var t=this,e=this.detected_Status?0:1;this.$store.dispatch("systemconfig/updateDetectStatus",e).then((function(e){200===e.status?(t.tempData=e.data,t.detected_Status=t.tempData.status,Object(i["Message"])({message:e.message,type:"success",duration:3e3})):Object(i["Message"])({message:e.message,type:"error",duration:3e3})})).catch((function(t){console.error("保存失败:",t)}))},changeInputview:function(t){this.form.input_view=t,1===t?this.form.boxes=this.form.boxes.slice(0,1):2===t&&(this.form.boxes=this.form.boxes.slice(0,2)),this.redraw()},redraw:function(){var t=this.$refs.drawCanvas.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height),this.form.boxes.forEach((function(e){t.beginPath(),t.rect(e.x1,e.y1,e.width,e.height),t.stroke()}))}}},n=o,c=(s("d46d"),s("2877")),u=Object(c["a"])(n,r,a,!1,null,"bbf789a2",null);e["default"]=u.exports},d46d:function(t,e,s){"use strict";s("db80")},db80:function(t,e,s){}}]);